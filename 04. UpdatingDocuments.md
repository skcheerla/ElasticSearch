## Updating Documents in Elasticsearch

![Image](https://www.elastic.co/docs/deploy-manage/images/elasticsearch-reference-data_processing_flow.png?utm_source=chatgpt.com)

![Image](https://i.gyazo.com/dfd3f4023f66f6233b6688df80385da5.png?utm_source=chatgpt.com)

![Image](https://i.sstatic.net/eC5Yt.png?utm_source=chatgpt.com)

In Elasticsearch, **updates are internally handled as delete + reindex**, but APIs make this transparent.

---

## 1ï¸âƒ£ Update a Document by ID (Partial Update)

Updates only specified fields.

```http
POST my_index/_update/1
{
  "doc": {
    "experience": 13,
    "location": "Hyderabad"
  }
}
```

âœ” Other fields remain unchanged
âœ” Most common update method

---

## 2ï¸âƒ£ Full Document Replace (Overwrite)

Replaces the entire document.

```http
PUT my_index/_doc/1
{
  "name": "Ravi",
  "role": "SRE",
  "experience": 13
}
```

âš ï¸ Missing fields will be removed.

---

## 3ï¸âƒ£ Upsert (Update or Insert)

Creates document if it does not exist.

```http
POST my_index/_update/2
{
  "doc": {
    "name": "Anita",
    "role": "Cloud Architect"
  },
  "doc_as_upsert": true
}
```

---

## 4ï¸âƒ£ Scripted Update (Advanced)

Modify fields dynamically.

```http
POST my_index/_update/1
{
  "script": {
    "source": "ctx._source.experience += params.inc",
    "params": {
      "inc": 1
    }
  }
}
```

âœ” Useful for counters, metrics
âœ” Avoid heavy scripts in hot paths

---

## 5ï¸âƒ£ Update Multiple Documents (update_by_query)

Updates all documents matching a query.

```http
POST my_index/_update_by_query
{
  "query": {
    "term": {
      "role.keyword": "SRE"
    }
  },
  "script": {
    "source": "ctx._source.team = 'platform'"
  }
}
```

âš ï¸ Resource intensive
âœ” Use during off-peak hours

---

## 6ï¸âƒ£ Bulk Updates (High Performance)

```http
POST _bulk
{ "update": { "_index": "my_index", "_id": "1" } }
{ "doc": { "experience": 14 } }
{ "update": { "_index": "my_index", "_id": "2" } }
{ "doc": { "location": "Bangalore" } }
```

âœ” Best for large-scale updates

---

## 7ï¸âƒ£ Handle Version Conflicts

```http
POST my_index/_update/1?retry_on_conflict=3
{
  "doc": {
    "experience": 15
  }
}
```

âœ” Prevents failures in concurrent updates

---

## 8ï¸âƒ£ Refresh Behavior

```http
POST my_index/_refresh
```

âš ï¸ Avoid frequent refreshes; hurts performance.

---

## ğŸ§  Important Update Rules

| Rule                           | Explanation           |
| ------------------------------ | --------------------- |
| Updates are reindex internally | No in-place update    |
| ID is mandatory                | Update requires `_id` |
| Mapping cannot be changed      | Reindex needed        |
| Scripts increase CPU           | Use carefully         |

---

## ğŸ¯ Interview-Ready Answer

> *â€œElasticsearch updates are internally delete-and-reindex operations. We use partial updates via Update API, scripted updates for counters, update_by_query for bulk changes, and manage conflicts using retry_on_conflict.â€*

---

## ğŸš€ Want Next?

I can explain:

* Reindex API (mapping changes)
* Optimistic locking & versions
* Update vs Index performance
* Real production update failures

Just tell me ğŸ‘
