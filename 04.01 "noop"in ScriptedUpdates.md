## What is `"noop"` in Scripted Updates in Elasticsearch?

![Image](https://miro.medium.com/v2/resize%3Afit%3A1358/format%3Awebp/1%2A4fsmffSA8fXsj85hLwxo3Q.png?utm_source=chatgpt.com)

![Image](https://bdbq-assets.storage.googleapis.com/bdbq-blog/e0k551_211858b0-84a7-11ea-8886-91b327b8b995.jpg?utm_source=chatgpt.com)

![Image](https://i.sstatic.net/eC5Yt.png?utm_source=chatgpt.com)

In Elasticsearch scripted updates, **`noop` (No Operation)** tells Elasticsearch:

> **â€œDo nothing â€” donâ€™t reindex this document.â€**

This is critical because **updates are normally delete + reindex**. `noop` **skips that expensive operation** when no change is needed.

---

## ğŸ”¹ How `noop` Works Internally

1. Elasticsearch loads the document
2. Script runs
3. Script decides **no change required**
4. Script sets:

```painless
ctx.op = 'noop'
```

5. Elasticsearch **skips reindexing**

âœ” Saves CPU
âœ” Saves disk I/O
âœ” Prevents unnecessary version bumps

---

## 1ï¸âƒ£ Simple `noop` Example

Only update `last_login` **if it is older**.

```http
POST my_index/_update/1
{
  "script": {
    "source": """
      if (ctx._source.last_login == params.new_time) {
        ctx.op = 'noop';
      } else {
        ctx._source.last_login = params.new_time;
      }
    """,
    "params": {
      "new_time": "2025-01-01T10:00:00"
    }
  }
}
```

### What happens:

| Condition      | Action              |
| -------------- | ------------------- |
| Same timestamp | `noop` â†’ no reindex |
| Different      | Update & reindex    |

---

## 2ï¸âƒ£ Counter Example with `noop`

Avoid updating when increment is zero.

```http
POST my_index/_update/1
{
  "script": {
    "source": """
      if (params.inc == 0) {
        ctx.op = 'noop';
      } else {
        ctx._source.count += params.inc;
      }
    """,
    "params": {
      "inc": 0
    }
  }
}
```

âœ” Prevents unnecessary writes

---

## 3ï¸âƒ£ Conditional Business Rule Example

Only update status if it actually changes.

```http
POST my_index/_update/1
{
  "script": {
    "source": """
      if (ctx._source.status == params.status) {
        ctx.op = 'noop';
      } else {
        ctx._source.status = params.status;
      }
    """,
    "params": {
      "status": "active"
    }
  }
}
```

---

## 4ï¸âƒ£ `noop` in `update_by_query`

Skips reindex for matched docs that donâ€™t need change.

```http
POST my_index/_update_by_query
{
  "script": {
    "source": """
      if (ctx._source.team == 'platform') {
        ctx.op = 'noop';
      } else {
        ctx._source.team = 'platform';
      }
    """
  }
}
```

âœ” Huge performance gain for large datasets

---

## ğŸ” Response When `noop` Happens

```json
{
  "_index": "my_index",
  "_id": "1",
  "result": "noop"
}
```

âœ” No version change
âœ” No disk write

---

## ğŸ§  Why `noop` Is Important (Production Insight)

Without `noop`:

* Same value update â†’ full reindex
* Higher CPU & disk usage
* Unnecessary shard merges

With `noop`:

* Intelligent updates
* Better cluster stability
* Lower latency

---

## âš ï¸ Common Mistakes

| Mistake                         | Fix                            |
| ------------------------------- | ------------------------------ |
| Forgetting equality check       | Add `noop`                     |
| Overusing scripts               | Use for conditional logic only |
| Expecting `noop` to skip script | Script always runs             |

---

## ğŸ¯ Interview-Ready Answer

> *â€œ`noop` in Elasticsearch scripted updates tells the engine to skip reindexing when no changes are required. Itâ€™s used by setting `ctx.op = 'noop'` inside a script to avoid unnecessary writes and improve performance.â€*

---

If you want next:

* `noop` vs version conflicts
* Script performance tuning
* Real production outage story involving missing `noop`

Just tell me ğŸ‘
